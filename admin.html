<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Clinique Parfum</title>
<link rel="stylesheet" href="main.css">
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>
<script src="firebase.js"></script>
</head>
<body>
<header>
  <h1>Admin Dashboard</h1>
</header>

<section class="block">
  <h2>Add Product</h2>
  <form id="addProductForm">
    <input type="text" id="prodName" placeholder="Product Name" required>
    <input type="number" id="prodPrice" placeholder="Price" required>
    <input type="text" id="prodImage" placeholder="Image Filename (e.g. Armstrong.png)" required>
    <button type="submit">Add Product</button>
  </form>
  <p id="addStatus"></p>
</section>

<section class="block">
  <h2>Existing Products</h2>
  <div id="productList" class="product-grid"></div>
</section>

<section class="block">
  <h2>Orders</h2>
  <div id="orderList"></div>
</section>

<script>
const productRef = db.ref("products");
const orderRef = db.ref("orders");

// ADD PRODUCT
document.getElementById("addProductForm").addEventListener("submit", e => {
  e.preventDefault();
  const name = document.getElementById("prodName").value;
  const price = document.getElementById("prodPrice").value;
  const image = document.getElementById("prodImage").value;

  const newProd = { name, price, image };
  productRef.push(newProd);
  document.getElementById("addStatus").innerText = "Product added!";
  e.target.reset();
});

// LIST PRODUCTS + DELETE
function loadProducts() {
  const list = document.getElementById("productList");
  productRef.on("value", snap => {
    list.innerHTML = "";
    snap.forEach(child => {
      const p = child.val();
      const id = child.key;

      const card = document.createElement("div");
      card.className = "product-card";
      card.innerHTML = `
        <img src="images/${p.image}">
        <h3>${p.name}</h3>
        <p class="price">â‚±${p.price}</p>
        <button onclick="deleteProduct('${id}')">Delete</button>
      `;
      list.appendChild(card);
    });
  });
}

function deleteProduct(id){
  productRef.child(id).remove();
}

loadProducts();

// LOAD ORDERS
const orderList = document.getElementById("orderList");
orderRef.on("value", snap => {
  orderList.innerHTML = "";
  snap.forEach(child => {
    const o = child.val();
    const div = document.createElement("div");
    div.className = "order-card";
    div.innerHTML = `
      <p><strong>${o.name}</strong> ordered <em>${o.products.join(", ")}</em></p>
      <p>Email: ${o.email}</p>
      <p>Phone: ${o.phone}</p>
      <p>Time: ${new Date(o.time).toLocaleString()}</p>
    `;
    orderList.appendChild(div);
  });
});
</script>
</body>
</html>
